/*! mhadley v1.3.0-474fe9ca by Danny Hadley <danny@dadleyy.com> [https://github.com/dadleyy/markhadley.la] */!function(a,b){b["true"]=a;var c,d=function(a,b){return function(){return a.apply(b,arguments)}};c=function(){var a,b,d,e;return c=angular.module("mh",["ngRoute","ngResource"]),e=function(a){var b,d;return d=a.data,c.value("CONFIG",d),c.value("URLS",d.urls),c.value("GOOGLE",d.google),c.value("BACKGROUND",d.background),d.soundcloud&&d.soundcloud.client_id&&(b=atob(d.soundcloud.client_id),c.value("SOUNDCLOUD_KEY",b),c.value("SOUNDCLOUD_USER",d.soundcloud.user_id)),angular.bootstrap(document,["mh"])},a=function(){},d=angular.injector(["ng"]),b=d.get("$http"),b.get("/app.conf").then(e,a),c}(),c.config(["$locationProvider",function(a){return a.html5Mode(!0)}]),function(a){return function(){var a;return a=function(a,b,c,d){var e,f,g,h,i,j;for(e=[],i=0,j=b.length;j>i;i++)g=b[i],h=g.tag_list,f=/featured/i.test(h),f&&e.push(g);return a.playlists=e,a.about_page=c,a.colors=d},a.$inject=["$scope","playlists","about_page","colors"],c.controller("HomeController",a)}}(this)(),c.directive("mhBackground",["BACKGROUND",function(a){var b;return b={replace:!0,templateUrl:"directives.background",scope:{},link:function(b,c,d){var e;return e=["url(",a,")"].join(""),c.css("background-image",e)}}}]),c.directive("mhBio",["$sce",function(a){var b;return b={replace:!0,templateUrl:"directives.bio",scope:{page:"="},link:function(b,c,d){return b.safe=function(){return a.trustAsHtml(b.page.content)}}}}]),c.directive("mhDiscography",["$timeout","Viewport","Audio",function(a,b,c){var d;return d={replace:!0,templateUrl:"directives.discography",scope:{colors:"=",playlists:"="},link:function(b,d,e){var f;return b.active_index=0,b.nav=function(a){var d;return d=b.playlists.length-1,b.active_index+=a,c.stop(),b.active_index<0&&(b.active_index=0),b.active_index>d&&(b.active_index=d),b.$broadcast("playlist_change",b.active_index)},f=function(){return b.$broadcast("playlist_change",0)},a(f)}}}]),c.directive("mhFooter",["$rootScope",function(a){var b;return b={replace:!0,templateUrl:"directives.footer",scope:{},link:function(b,c,d){var e;return b.active=!1,e=function(a,c){var d;return d=c.$$route,d?b.active=d.name:void 0},a.$on("$routeChangeStart",e)}}}]),c.directive("mhHeader",["Loop",function(a){var b,c,d,e,f,g;return b=20,e=function(){return window.pageYOffset?window.pageYOffset:document.documentElement.scrollTop},c=document.body,f=document.documentElement,d=function(){var a,b;return b=[c.scrollHeight,c.offsetHeight,f.clientHeight,f.scrollHeight,f.offsetHeight],a=Math.max.apply(null,b),a-window.innerHeight},g={replace:!0,templateUrl:"directives.header",scope:{},link:function(c,f,g){var h,i,j;return i=null,h=0,j=function(){var b,c,f;return f=e(),b=d(),h*=1.05,c=f+h,scrollTo(0,c),c>b?a.remove(i):0>c?a.remove(i):void 0},c.scroll=function(){var c;return c=e()<.5*d(),h=c?b:-b,i=a.add(j)}}}}]),c.directive("mhPageTitle",["$rootScope","Analytics",function(a,b){var c,d;return c="Composer",d={scope:{},link:function(d,e,f){var g,h,i;return i=function(a,d){var f,g,h;return f=d.$$route,g=f&&f.title?f.title:c,h=["Mark Hadley",g].join(" | "),e.html(h),b.track(f.originalPath,f.title)},h=function(a,c){var d;return d=c.$$route,d?b.event("routing","route_start",d.originalPath):void 0},g=function(a,c){var d;return d=c.$$route,d?b.event("routing","route_error",d.originalPath):void 0},a.$on("$routeChangeStart",h),a.$on("#routeChangeError",g),a.$on("$routeChangeSuccess",i)}}}]),c.directive("mhPlayer",["Audio",function(a){var b;return b={replace:!0,templateUrl:"directives.player",require:"^mhPlaylist",scope:{track:"="},link:function(a,b,c,d){return a.close=function(){return d.close()},a.stop=function(){return a.track.pause()},a.play=function(){return a.track.play()},a.next=function(){return d.playNext()},a.back=function(){return d.playPrevious()},a.playing=function(){return a.track.isPlaying()}}}}]),c.directive("mhPlaylist",["Viewport","Loop","Audio","Drawing",function(a,b,c,d){var e,f,g,h,i,j,k,l;return k=function(a){return parseFloat(a)},l=function(a){return parseInt(a)},f=.2,j=function(a){var b;return b=100*Math.random()%.5+.1,a%2===0?b:-b},g=function(a,b){var c,d,e,f,g,h,i,j,k,m;for(f=this.scope.colors,j=this.playlist.id,k=0,m=f.length;m>k;k++)d=f[k],i=l(d.id),i===a.id?h=d.color:i===j&&(e=d.color.split(","),g=e[b%e.length]);return c=(g||"#fff").replace(/\s/g,""),["#",c].join("")},i=function(a){var b;return b=this.active_index+a,b>this.tracks.length-1?b=0:0>b&&(b=this.tracks.length-1),this.tracks[b].play()},e=function(){function a(a,b){this.scope=a,this.rings=[],this.tracks=[],this.rotation_offsets=[],this.svg=d3.select(b[0]).append("svg"),this.ring_container=this.svg.append("g"),this.playback_ring=this.ring_container.append("path"),this.arc=d.arcFactory(a),this.width=100,this.height=100,this.playlist=this.scope.playlist,this.active_index=-1,this.playlist_rotation=0,this.playback_ring.attr({fill:"white"})}return a.prototype.playNext=function(){return i.call(this,1)},a.prototype.playPrevious=function(){return i.call(this,-1)},a.prototype.draw=function(){var a,b,c,d,e,g,h,i,j;for(this.playlist_rotation+=f,this.active_index>=0&&(e=this.tracks[this.active_index],this.playback_ring.attr({d:this.arc.playback(e)})),i=this.rings,j=[],a=g=0,h=i.length;h>g;a=++g)c=i[a],b=this.rotation_offsets[a],this.scope.active?j.push(c.rotate(this.playlist_rotation)):(d=a%2===0?-this.playlist_rotation:this.playlist_rotation,j.push(c.rotate(b+d)));return j},a.prototype.resize=function(a,b){return this.width=a,this.height=b,this.svg.attr({width:this.width,height:this.height}),this.center(),this.draw()},a.prototype.center=function(){var a,b,c,d;return d=this.width,a=this.height,c=this.scope.active?120:.5*a,b=.5*d,this.ring_container.attr({transform:"translate("+b+","+c+")"})},a.prototype.open=function(){var a,b,c,d,e,f,h,i,j,k;for(this.center(),a=this.tracks[this.active_index],b=g.call(this,a,this.active_index),this.playback_ring.attr({opacity:"1.0",fill:b}),j=this.rings,k=[],c=h=0,i=j.length;i>h;c=++h)f=j[c],d=this.tracks[c],e=d.playing?"1.0":"0.5",f.path.transition().duration(400).ease("elastic").attr({opacity:e,d:this.arc.fn(d,c)}),k.push(f.speed=.2);return k},a.prototype.close=function(){var a,b,c,d,e,f;for(this.scope.active&&this.scope.active.stop(),this.scope.active=null,this.active_index=-1,this.playback_ring.attr({opacity:"0.0"}),this.center(),f=this.rings,a=d=0,e=f.length;e>d;a=++d)c=f[a],b=this.tracks[a],c.path.transition().duration(400).ease("elastic").attr({opacity:"1.0",d:this.arc.fn(b,a)}),c.speed=j(a);try{return this.scope.$digest()}catch(g){return!1}},a.prototype.addTrack=function(a){var b,e,f,h,i,j,k,l,m,n,o,p,q;return i=this.tracks.length,q=!1,h=this.ring_container.append("g"),m=h.append("path"),f=g.call(this,a,i),h.attr("data-track",a.title),j=new c.Track(a),b=function(a){return function(){return a.arc.fn(j,i)}}(this),m.attr({fill:f,d:b()}),n=new d.Ring(h,m,b),this.rotation_offsets.push(1e3*Math.random()%360),e=function(a){return function(){return j.playing?j.stop():(q=!0,j.play(),q=!1)}}(this),p=function(a){return function(){return a.scope.active=null,a.close()}}(this),o=function(a){return function(){a.scope.active=j,a.active_index=i,a.open();try{a.scope.$digest()}catch(b){}return a.scope.$broadcast("playback_start",j)}}(this),l=function(a){return function(){}}(this),k=function(a){return function(){}}(this),n.on("click",e).on("mouseover",l).on("mouseout",k),j.on("stop",p).on("start",o),this.rings.push(n),this.tracks.push(j)},a}(),e.$inject=["$scope","$element"],h={replace:!0,templateUrl:"directives.playlist",controller:e,scope:{playlist:"=",index:"=",colors:"="},link:function(c,d,e,f){var g,h,i,j,k,l,m,n,o,p;for(c.active=null,g=null,h=function(){var a,b;return b=d[0].offsetWidth,a=d[0].offsetHeight,f.resize(b,a)},i=function(){return f.draw()},k=function(){return g&&b.remove(g),g=null},j=function(){return g=b.add(i)},l=function(a,b){return b===c.index?j():k()},a.addListener(h),p=c.playlist.tracks,n=0,o=p.length;o>n;n++)m=p[n],f.addTrack(m);return h(),c.$on("playlist_change",l)}}}]),c.directive("mhWaveform",["$http","Viewport","Waveform",function(a,b,c){var d;return d={replace:!0,templateUrl:"directives.waveform",scope:{track:"="},link:function(d,e,f){var g,h,i,j,k,l,m,n,o;return g=document.createElement("canvas"),h=g.getContext("2d"),n=null,m=new c({canvas:g,innerColor:"#414141"}),o=0,i=0,j=function(a){var b;return b=a.data,m.width=o,m.height=i,m.update({data:b})},l=function(b,c){var d,e;return n=null,e=c.waveform(),d=a.get("/api/waveform",{params:{url:e}}),d.then(j)},k=function(){return o=e[0].offsetWidth,i=e[0].offsetHeight,m.width=o,m.height=i,g.width=o,g.height=i,m.redraw()},b.addListener(k),d.$on("playback_start",l),e.append(g)}}}]),c.config(["$routeProvider",function(a){return a.otherwise({redirectTo:"/"})}]),c.config(["$routeProvider",function(a){var b;return b="https://api.soundcloud.com",a.when("/",{templateUrl:"views.home",controller:"HomeController",name:"home",resolve:{playlists:["$q","$http","SOUNDCLOUD_KEY","SOUNDCLOUD_USER",function(a,c,d,e){var f,g,h,i,j,k;return f=a.defer(),k=[b,"users",e,"playlists.json"].join("/"),j=["client_id",d].join("="),h=function(a){var b;return b=a.data,f.resolve(b)},g=function(){},i=c.get([k,j].join("?")),i.then(h,g),f.promise}],about_page:["$q","$http","URLS",function(a,b,c){var d,e,f,g,h;return g=a.defer(),f=[c.blog,"pages"].join("/"),d=["filter[name]","about"].join("="),e=b.get([f,d].join("?")),h=function(a){return g.resolve(a.data[0])},e.then(h),g.promise}],colors:["$q","$http","CONFIG",function(a,b,c){var d,e,f,g;return f=a.defer(),e=c.colors_sheet,d=b.get(e),g=function(a){var b;return b=Papa.parse(a.data,{header:!0}),f.resolve(b.data)},d.then(g),f.promise}]}})}]),c.service("Analytics",["GOOGLE",function(a){var b;return ga("create",a.tracking,"auto"),ga("send","pageview"),b={track:function(a,b){return ga("send","pageview",{page:a,title:b})},log:function(){},event:function(a,b,c){return ga("send","event",a,b,c)}}}]),c.service("Audio",["$q","Analytics","Loop","SOUNDCLOUD_KEY",function(a,b,c,d){var e,f,g,h;return g=null,soundManager.setup({debugMode:!1}),h=function(a){var b,c,d,e,f;for(e=this.listeners[a],f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(b());return f},f=function(){function a(a){var b;this.track=a,b=["client_id",d].join("="),this.id=this.track.id,this.playing=!1,this.playback_loop=null,this.listeners={start:[],stop:[],playback:[],pause:[]},this.sound=soundManager.createSound({url:[this.track.stream_url,b].join("?")})}return a.prototype.position=function(){return this.sound.position},a.prototype.duration=function(){return this.track.duration},a.prototype.title=function(){return this.track.title},a.prototype.waveform=function(){return this.track.waveform_url},a.prototype.isPlaying=function(){return this.playing},a.prototype.pause=function(){return this.playing=!1,g=null,h.call(this,"pause"),this.sound.stop()},a.prototype.play=function(){var a;return this.playing=!0,a=function(a){return function(){return h.call(a,"playback")}}(this),g&&g.id!==this.id&&g.stop(),g=this,this.playback_loop=c.add(a),h.call(this,"start"),b.event("audio","playback:start",this.track.title),this.sound.play()},a.prototype.stop=function(){return this.playing=!1,c.remove(this.playback_loop),h.call(this,"stop"),this.sound.stop()},a.prototype.on=function(a,b){return this.listeners[a]&&angular.isFunction(b)&&this.listeners[a].push(b),this},a}(),e={stop:function(){return g?g.stop():void 0}},e.Track=f,e}]),c.service("Drawing",[function(){var a,b,c,d,e,f,g;return e=15,d=2,c=e+d,f=60,g=function(a){return parseFloat(a)},b=function(){function a(a,b,c){var d,e,f,g;this.group=a,this.path=b,this.arc_fn=c,this.position={x:0,y:0},this.rotation=1e3*Math.random()%360,this.stopped=!1,this.listeners={click:[],mouseout:[],mouseover:[]},g=function(a){return function(b){var c,d,e,f,g;for(f=a.listeners[b],g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(c());return g}}(this),f=function(a){return function(){return a.stopped=!0,a.scale=1.2,g("mouseover")}}(this),e=function(a){return function(){return a.stopped=!1,a.scale=1,g("mouseout")}}(this),d=function(a){return function(){return g("click")}}(this),this.group.on("mouseover",f).on("mouseout",e).on("click",d)}return a.prototype.rotate=function(a){var b;return this.rotation=a,b=["rotate(",this.rotation,")"].join(""),this.path.attr({transform:b})},a.prototype.update=function(){},a.prototype.on=function(a,b){return this.listeners[a]&&angular.isFunction(b)&&this.listeners[a].push(b),this},a}(),a={Ring:b,arcFactory:function(a){var b,d,h,i,j,k,l,m,n,o,p,q,r,s,t;for(m=a.playlist,b={},p=0,t=m.tracks,r=0,s=t.length;s>r;r++)q=t[r],p+=g(q.duration);return j=-1,n=function(a){var b,c,d;return b=a.duration,c=g(b)/p,d=360*c*(Math.PI/180)},i=function(a){var b,c,d,e,f;for(b=-1,f=m.tracks,c=d=0,e=f.length;e>d;c=++d)q=f[c],q.id===a.id&&(b=c);return b},k=function(b){var d,e,g;return a.active?g=80:(d=i(b),e=f+d*c)},l=function(b){var d,g,h,j;return a.active?j=95:(d=i(b),g=f+d*c,h=g+e)},h=function(b,c){var d,e,f;return e=0,a.active?(f=o(b,c),d=n(b.track),e=f+d):e=n(b.track),e},o=function(b,c){var d,e,f,g;return g=0,a.active&&c>0&&(e=m.tracks[c-1],d=o(e,c-1),f=n(e),g=d+f),g},d=function(a,b){var c,d,e;return c=a.duration(),d=g(b)/g(c),e=360*d*(Math.PI/180)},b.fn=d3.svg.arc().startAngle(o).endAngle(h).innerRadius(k).outerRadius(l),b.playback=d3.svg.arc().startAngle(function(){return 0}).endAngle(function(a){var b,c,d;return b=a.duration(),d=a.position(),c=d/b,360*c*(Math.PI/180)}).innerRadius(function(){return 75}).outerRadius(function(){return 60}),b}}}]),c.service("Loop",["$window",function(a){var b,c,d,e,f,g,h,i,j,k,l;for(e=function(){var a;return a=0,function(){return a+=1}}(),c=[],h=!1,j=["","ms","moz","webkit","o"],f=function(b){return a.setTimeout(b,33)},k=0,l=j.length;l>k;k++)if(i=j[k],d=i+"RequestAnimationFrame",d=d[0].toLowerCase()+d.substr(1),a[d]){f=a[d];break}return g=function(){var a,b,d;if(0===c.length)h=!1;else for(b=0,d=c.length;d>b;b++)(a=c[b])();return h?f(g):void 0},b={add:function(a){var b;return b=function(){return a()},b.uid=e(),c.push(b),h||(h=!0,g()),b.uid},remove:function(a){var b,d,e,f,g;for(g=[],b=e=0,f=c.length;f>e;b=++e){if(d=c[b],d.uid===a){c.splice(b,1);break}g.push(void 0)}return g}}}]),c.service("Viewport",["$window","$rootScope","Loop",function(a,b,c){var d,e,f,g,h,i;return f=null,e=[],h=null,g=function(){return c.remove(f),f=null},a.onresize=function(){return null===f&&(f=c.add(i)),a.clearTimeout(h),h=a.setTimeout(g,1e3)},i=function(){var c,d,f,g,h;for(f=a.innerWidth,c=a.innerHeight,g=0,h=e.length;h>g;g++)(d=e[g])(f,c);return b.$digest()},d={addListener:function(b){return e.push(b),b(a.innerWidth,a.innerHeight)}}}]),c.service("Waveform",[function(){var a;return a=function(){function a(a){this.redraw=d(this.redraw,this),this.container=a.container,this.canvas=a.canvas,this.data=a.data||[],this.outerColor=a.outerColor||"transparent",this.innerColor=a.innerColor||"#FFFFFF",this.interpolate=!0,a.interpolate===!1&&(this.interpolate=!1),this.patchCanvasForIE(this.canvas),this.context=this.canvas.getContext("2d")}return a.prototype.setData=function(a){return this.data=a},a.prototype.setDataInterpolated=function(a){return this.setData(this.interpolateArray(a,this.width))},a.prototype.setDataCropped=function(a){return this.setData(this.expandArray(a,this.width))},a.prototype.update=function(a){return null!=a.interpolate&&(this.interpolate=a.interpolate),this.interpolate===!1?this.setDataCropped(a.data):this.setDataInterpolated(a.data),this.redraw()},a.prototype.redraw=function(){var a,b,c,d,e,f,g,h;for(this.clear(),this.context.fillStyle=this.innerColor,c=this.height/2,b=0,g=this.data,h=[],e=0,f=g.length;f>e;e++)a=g[e],d=this.width/this.data.length,this.context.clearRect(d*b,c-c*a,d,c*a*2),this.context.fillRect(d*b,c-c*a,d,c*a*2),h.push(b++);return h},a.prototype.clear=function(){return this.context.fillStyle=this.outerColor,this.context.clearRect(0,0,this.width,this.height),this.context.fillRect(0,0,this.width,this.height)},a.prototype.patchCanvasForIE=function(a){var b;return"undefined"!=typeof window.G_vmlCanvasManager?(a=window.G_vmlCanvasManager.initElement(a),b=a.getContext,a.getContext=function(c){var d;return d=b.apply(a,arguments),a.getContext=b,d}):void 0},a.prototype.expandArray=function(a,b,c){var d,e,f,g;if(null==c&&(c=0),e=[],a.length>b)e=a.slice(a.length-b,a.length);else for(d=f=0,g=b-1;g>=0?g>=f:f>=g;d=g>=0?++f:--f)e[d]=a[d]||c;return e},a.prototype.linearInterpolate=function(a,b,c){return a+(b-a)*c},a.prototype.interpolateArray=function(a,b){var c,d,e,f,g,h,i;for(g=new Array,h=new Number((a.length-1)/(b-1)),g[0]=a[0],f=1;b-1>f;)i=f*h,e=new Number(Math.floor(i)).toFixed(),c=new Number(Math.ceil(i)).toFixed(),d=i-e,g[f]=this.linearInterpolate(a[e],a[c],d),f++;return g[b-1]=a[a.length-1],g},a}()}]),angular.module("mh").run(["$templateCache",function(a){"use strict";a.put("directives.background",'<div class="background"></div>'),a.put("directives.bio",'<div class="bio"><div ng-bind-html="safe()" class="content"></div></div>'),a.put("directives.discography",'<div class="discography"><div class="controls"><div ng-class="{actionable: active_index &gt; 0}" class="left"><button ng-click="nav(-1)" class="ion icon left"></button></div><div ng-class="{actionable: active_index &lt; playlists.length - 1}" class="right"><button ng-click="nav(1)" class="ion icon right"></button></div></div><div ng-repeat="playlist in playlists" ng-class="{active: $index === active_index, prev: $index === active_index - 1, next: $index === (active_index + 1)}" class="playlist-container"><div mh-playlist="mh-playlist" playlist="playlist" index="$index" colors="colors" class="playlist"></div></div></div>'),a.put("directives.footer",'<div class="footer"><div class="inner"><div class="social"><a href="http://www.twitter.com/markhadleymusic" class="icon twitter"></a><a href="https://soundcloud.com/hadley-mark" class="icon soundcloud"></a><a href="http://www.youtube.com/user/MHQ89" class="icon youtube"></a><a href="mailto:mark@markhadleymusic.com" class="icon ion email"></a></div><div ng-attr-active="active" class="links"><a href="http://www.imdb.com/name/nm4837665/" target="_blank" class="normal">imdb</a></div></div></div>'),a.put("directives.header",'<div class="header"><div class="padding"></div><div class="locker"><div class="inner"><div class="name-container"><h1 ng-click="scroll()" class="name normal">Mark<em class="light">Hadley</em></h1></div></div></div></div>'),a.put("directives.player",'<div class="player"><div ng-if="track" class="player-guts"><div class="track-title"><h2 class="title light">{{track.title()}}</h2></div><div mh-waveform="track" class="waveform"></div><div class="player-controls"><div class="actions"><button ng-click="back()" class="ion icon back"></button><button ng-click="stop()" ng-if="playing()" class="ion icon stop"></button><button ng-click="play()" ng-if="!playing()" class="ion icon play"></button><button ng-click="close()" class="ion icon close"></button><button ng-click="next()" class="ion icon next"></button></div></div></div></div>'),a.put("directives.playlist",'<div class="playlist"><div class="title-container"><h1 class="light playlist-title">{{playlist.title}}</h1></div><div class="player-container"><div mh-player="mh-player" track="active" class="player"></div></div><div class="playlist-guts"></div></div>'),a.put("directives.waveform",'<div class="waveform"></div>'),a.put("views.home",'<div class="home view"><div class="container"><div mh-discography="mh-discography" playlists="playlists" colors="colors" class="discography"></div><div mh-bio="mh-bio" page="about_page" class="bio"></div></div></div>')}])}({},function(){return this}());